<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Converter+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for file list */
        .file-list::-webkit-scrollbar {
            width: 6px;
        }
        .file-list::-webkit-scrollbar-track {
            background: #2d3748; /* slate-800 */
            border-radius: 10px;
        }
        .file-list::-webkit-scrollbar-thumb {
            background: #4a5568; /* slate-600 */
            border-radius: 10px;
        }
        .file-list::-webkit-scrollbar-thumb:hover {
            background: #718096; /* slate-500 */
        }
        .loader {
            border-top-color: #3498db; /* sky-500 */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Ensure buttons are not too small on mobile */
        button {
            min-width: 120px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 text-slate-100 min-h-screen flex flex-col items-center justify-center p-4 selection:bg-sky-500 selection:text-white">

    <div class="bg-slate-800 shadow-2xl rounded-xl p-6 md:p-8 w-full max-w-2xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-sky-400">PDF Converter+</h1>
            <p class="text-slate-400 mt-2">Your simple tool for PDF creation. Currently supports Images to PDF.</p>
        </header>

        <main>
            <div class="mb-6">
                <label for="imageUpload" class="block text-sm font-medium text-slate-300 mb-2">Select Images (JPG, PNG) to convert to PDF:</label>
                <input type="file" id="imageUpload" multiple accept="image/jpeg, image/png"
                    class="block w-full text-sm text-slate-400
                           file:mr-4 file:py-2 file:px-4
                           file:rounded-lg file:border-0
                           file:text-sm file:font-semibold
                           file:bg-sky-600 file:text-sky-50
                           hover:file:bg-sky-700
                           cursor-pointer focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500 rounded-lg border border-slate-600 p-2.5">
            </div>

            <div class="mb-6">
                <h3 class="text-sm font-medium text-slate-300 mb-1">Selected Files:</h3>
                <div id="fileList" class="file-list max-h-32 overflow-y-auto bg-slate-700 p-3 rounded-lg border border-slate-600 text-xs text-slate-300">
                    No files selected.
                </div>
            </div>
            
            <div class="mb-6">
                <label for="pageSize" class="block text-sm font-medium text-slate-300 mb-1">PDF Page Size:</label>
                <select id="pageSize" class="w-full p-2 bg-slate-700 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none">
                    <option value="A4">A4</option>
                    <option value="Letter">Letter</option>
                    <option value="FitImage">Fit to Image (First Image)</option>
                </select>
            </div>

            <div class="mb-6 text-center">
                <button id="convertToPdfButton"
                    class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md transition-all duration-150 ease-in-out transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center mx-auto">
                    <span id="buttonText">Convert to PDF</span>
                    <div id="loader" class="loader w-5 h-5 rounded-full border-2 border-slate-300 border-t-sky-500 ml-2 hidden"></div>
                </button>
            </div>

            <div id="statusArea" class="min-h-[24px] mb-4 text-sm text-center font-medium">
                </div>
            <div id="downloadArea" class="text-center">
                </div>
        </main>

        <footer class="mt-8 text-center">
            <p class="text-xs text-slate-500">
                Create PDF documents right in your browser. Your files are not uploaded to any server.
            </p>
        </footer>
    </div>

    <script>
        // Get DOM elements
        const imageUpload = document.getElementById('imageUpload');
        const fileListDiv = document.getElementById('fileList');
        const convertToPdfButton = document.getElementById('convertToPdfButton');
        const buttonText = document.getElementById('buttonText');
        const loader = document.getElementById('loader');
        const statusArea = document.getElementById('statusArea');
        const downloadArea = document.getElementById('downloadArea');
        const pageSizeSelect = document.getElementById('pageSize');

        let selectedFiles = [];

        // pdf-lib objects
        const { PDFDocument, StandardFonts, rgb, PageSizes } = PDFLib;

        /**
         * Updates the list of selected files displayed to the user.
         */
        imageUpload.addEventListener('change', (event) => {
            selectedFiles = Array.from(event.target.files);
            fileListDiv.innerHTML = ''; // Clear previous list
            downloadArea.innerHTML = ''; // Clear previous download link
            statusArea.textContent = ''; // Clear previous status

            if (selectedFiles.length > 0) {
                const ul = document.createElement('ul');
                ul.className = 'list-disc list-inside';
                selectedFiles.forEach(file => {
                    const li = document.createElement('li');
                    li.textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
                    ul.appendChild(li);
                });
                fileListDiv.appendChild(ul);
                convertToPdfButton.disabled = false;
            } else {
                fileListDiv.textContent = 'No files selected.';
                convertToPdfButton.disabled = true;
            }
        });

        /**
         * Shows a status message.
         * @param {string} message - The message to display.
         * @param {'success' | 'error' | 'info'} type - The type of message.
         */
        function showStatus(message, type = 'info') {
            statusArea.textContent = message;
            statusArea.classList.remove('text-emerald-400', 'text-rose-400', 'text-sky-400');
            switch (type) {
                case 'success': statusArea.classList.add('text-emerald-400'); break;
                case 'error': statusArea.classList.add('text-rose-400'); break;
                case 'info': default: statusArea.classList.add('text-sky-400'); break;
            }
        }
        
        /**
         * Sets the button state to loading or idle.
         * @param {boolean} isLoading - True if loading, false otherwise.
         */
        function setButtonLoading(isLoading) {
            if (isLoading) {
                convertToPdfButton.disabled = true;
                buttonText.textContent = 'Processing...';
                loader.classList.remove('hidden');
            } else {
                convertToPdfButton.disabled = false;
                buttonText.textContent = 'Convert to PDF';
                loader.classList.add('hidden');
            }
        }

        /**
         * Handles the PDF conversion process.
         */
        convertToPdfButton.addEventListener('click', async () => {
            if (selectedFiles.length === 0) {
                showStatus('Please select some images first.', 'error');
                return;
            }

            setButtonLoading(true);
            showStatus('Starting PDF generation...', 'info');
            downloadArea.innerHTML = ''; // Clear previous download link

            try {
                // Create a new PDFDocument
                const pdfDoc = await PDFDocument.create();
                const selectedPageSizeOption = pageSizeSelect.value;

                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    showStatus(`Processing image ${i + 1} of ${selectedFiles.length}: ${file.name}`, 'info');
                    
                    const imageBytes = await file.arrayBuffer();
                    let embeddedImage;

                    // Embed the image (JPG or PNG)
                    if (file.type === 'image/jpeg') {
                        embeddedImage = await pdfDoc.embedJpg(imageBytes);
                    } else if (file.type === 'image/png') {
                        embeddedImage = await pdfDoc.embedPng(imageBytes);
                    } else {
                        console.warn(`Skipping unsupported file type: ${file.name}`);
                        showStatus(`Skipped unsupported file: ${file.name}`, 'error');
                        continue; // Skip this file
                    }

                    // Get image dimensions
                    const { width: imgWidth, height: imgHeight } = embeddedImage.scale(1);
                    
                    let pageWidth, pageHeight;

                    if (selectedPageSizeOption === 'FitImage') {
                        // For FitImage, page size is determined by the current image if it's the first one,
                        // or by the first page's dimensions if subsequent pages are being added.
                        if (i === 0) { 
                            pageWidth = imgWidth;
                            pageHeight = imgHeight;
                        } else if (pdfDoc.getPageCount() > 0) {
                             const firstPage = pdfDoc.getPage(0); // Get the first page already added
                             pageWidth = firstPage.getWidth();
                             pageHeight = firstPage.getHeight();
                        } else { 
                            // Fallback if for some reason no pages exist yet (should ideally not be hit if i > 0)
                            pageWidth = imgWidth;
                            pageHeight = imgHeight;
                        }
                    } else { // A4 or Letter
                        const standardPageSize = PageSizes[selectedPageSizOption]; // e.g., PageSizes.A4
                        pageWidth = standardPageSize[0];
                        pageHeight = standardPageSize[1];
                    }

                    // Add a new page
                    const page = pdfDoc.addPage([pageWidth, pageHeight]);

                    // Calculate scaling to fit the image onto the page while maintaining aspect ratio
                    const xScale = page.getWidth() / imgWidth;
                    const yScale = page.getHeight() / imgHeight;
                    const scale = Math.min(xScale, yScale); // Use min to fit completely

                    const scaledWidth = imgWidth * scale;
                    const scaledHeight = imgHeight * scale;

                    // Center the image on the page
                    const xPos = (page.getWidth() - scaledWidth) / 2;
                    const yPos = (page.getHeight() - scaledHeight) / 2;
                    
                    // Draw the image on the page
                    page.drawImage(embeddedImage, {
                        x: xPos,
                        y: yPos,
                        width: scaledWidth,
                        height: scaledHeight,
                    });
                }

                if (pdfDoc.getPageCount() === 0) {
                    showStatus('No valid images were processed. PDF not created.', 'error');
                    setButtonLoading(false);
                    return;
                }

                // Serialize the PDFDocument to bytes (a Uint8Array)
                const pdfBytes = await pdfDoc.save();

                // Create a download link
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `converted_pdf_${Date.now()}.pdf`; // Changed filename slightly
                a.textContent = 'Download PDF';
                a.className = 'bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md inline-block transition-colors';
                
                downloadArea.innerHTML = ''; // Clear previous content
                downloadArea.appendChild(a);
                showStatus('PDF created successfully! Click the link to download.', 'success');

            } catch (error) {
                console.error('Error creating PDF:', error);
                showStatus(`Error creating PDF: ${error.message}`, 'error');
            } finally {
                setButtonLoading(false);
            }
        });

        // Initial button state
        convertToPdfButton.disabled = true;

    </script>
</body>
</html>

